<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polymarket AI Trading | b1rdmania</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1>polymarket ai trading</h1>
                    <p class="subtitle">MEAN REVERSION MODELS ON PREDICTION MARKETS</p>
                    <p style="margin-top: 8px; font-size: 0.85rem;">by <a href="https://github.com/b1rdmania" target="_blank">b1rdmania</a></p>
                </div>
                <div style="text-align: right;">
                    <div id="api-status" style="font-family: var(--font-mono); font-size: 0.75rem; margin-bottom: 4px;">● connecting...</div>
                    <a href="https://github.com/b1rdmania/polymarket-ai-trading" target="_blank" class="btn">View Code</a>
                </div>
            </div>
        </header>

        <nav>
            <a href="index.html" class="active">Dashboard</a>
            <a href="markets.html">Scanner</a>
            <a href="research.html">Research</a>
        </nav>

        <div class="content">
            <!-- Current Status -->
            <div class="card">
                <h3>System Status</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 16px;">
                    <div class="stat-box">
                        <div style="font-size: 0.75rem; color: var(--color-gray-mid); margin-bottom: 4px;">MODE</div>
                        <strong>Paper Trading</strong>
                    </div>
                    <div class="stat-box">
                        <div style="font-size: 0.75rem; color: var(--color-gray-mid); margin-bottom: 4px;">MODELS RUNNING</div>
                        <strong id="models-count">3</strong>
                    </div>
                    <div class="stat-box">
                        <div style="font-size: 0.75rem; color: var(--color-gray-mid); margin-bottom: 4px;">LAST UPDATE</div>
                        <strong id="last-update">--</strong>
                    </div>
                </div>
            </div>

            <!-- Model Performance -->
            <div class="card">
                <h3>Model Performance</h3>
                <div id="models-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin-top: 16px;">
                    <div class="loader">Loading models...</div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card">
                <h3>Recent Trades</h3>
                <div id="recent-trades" style="margin-top: 16px;">
                    <div class="loader">Loading trades...</div>
                </div>
            </div>

            <!-- Footer -->
            <div style="margin-top: 40px; padding-top: 24px; border-top: 1px solid var(--color-border); color: var(--color-gray-mid); font-size: 0.85rem;">
                <p><strong>Paper trading only.</strong> No real money at risk. Models scan Polymarket for mean reversion opportunities based on 40 years of prediction market research.</p>
                <p style="margin-top: 12px;">Research: <a href="research.html">Berg & Rietz (2018)</a> • <a href="research.html">Munger's Biases</a> • <a href="research.html">Mean Reversion in Markets</a></p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://polymarket-trading-system.onrender.com';
        
        // Update API status
        async function updateStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/health`);
                const data = await response.json();
                document.getElementById('api-status').textContent = '● backend connected';
                document.getElementById('api-status').style.color = 'var(--color-success)';
                
                const now = new Date();
                document.getElementById('last-update').textContent = now.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit'
                });
            } catch (error) {
                document.getElementById('api-status').textContent = '● backend offline';
                document.getElementById('api-status').style.color = 'var(--color-error)';
            }
        }

        // Load model data
        async function loadModels() {
            try {
                const response = await fetch(`${API_BASE}/api/models`);
                const data = await response.json();
                
                const grid = document.getElementById('models-grid');
                grid.innerHTML = '';
                
                if (!data.models || data.models.length === 0) {
                    grid.innerHTML = '<p style="color: var(--color-gray-mid);">No model data yet. Models are scanning markets...</p>';
                    return;
                }
                
                data.models.forEach(model => {
                    const card = document.createElement('div');
                    card.className = 'model-card';
                    card.style.border = `2px solid var(--color-${model.model})`;
                    
                    const winRate = model.total_trades > 0 ? model.win_rate.toFixed(1) : '0.0';
                    const pnl = model.total_pnl.toFixed(2);
                    const pnlColor = model.total_pnl > 0 ? 'var(--color-success)' : model.total_pnl < 0 ? 'var(--color-error)' : 'var(--color-gray-mid)';
                    
                    card.innerHTML = `
                        <h4 style="text-transform: uppercase; margin-bottom: 12px;">${model.model}</h4>
                        <div style="display: flex; flex-direction: column; gap: 8px; font-size: 0.9rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--color-gray-mid);">Total Trades</span>
                                <strong>${model.total_trades}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--color-gray-mid);">Win Rate</span>
                                <strong>${winRate}%</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--color-gray-mid);">Total P&L</span>
                                <strong style="color: ${pnlColor};">$${pnl}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--color-gray-mid);">Open Positions</span>
                                <strong>${model.open_positions}</strong>
                            </div>
                        </div>
                    `;
                    
                    grid.appendChild(card);
                });
                
                document.getElementById('models-count').textContent = data.models.length;
                
            } catch (error) {
                document.getElementById('models-grid').innerHTML = `<p style="color: var(--color-error);">Failed to load models: ${error.message}</p>`;
            }
        }

        // Load recent trades
        async function loadTrades() {
            try {
                const response = await fetch(`${API_BASE}/api/signals/live?limit=10`);
                const data = await response.json();
                
                const container = document.getElementById('recent-trades');
                
                if (!data.signals || data.signals.length === 0) {
                    container.innerHTML = '<p style="color: var(--color-gray-mid);">No trades yet. Models are scanning for opportunities...</p>';
                    return;
                }
                
                const table = document.createElement('table');
                table.style.width = '100%';
                table.style.fontSize = '0.85rem';
                table.innerHTML = `
                    <thead>
                        <tr style="text-align: left; border-bottom: 1px solid var(--color-border);">
                            <th style="padding: 8px;">Model</th>
                            <th style="padding: 8px;">Market</th>
                            <th style="padding: 8px;">Side</th>
                            <th style="padding: 8px;">Price</th>
                            <th style="padding: 8px;">P&L</th>
                            <th style="padding: 8px;">Status</th>
                        </tr>
                    </thead>
                    <tbody id="trades-body"></tbody>
                `;
                
                container.innerHTML = '';
                container.appendChild(table);
                
                const tbody = document.getElementById('trades-body');
                data.signals.slice(0, 10).forEach(signal => {
                    const pnlColor = signal.pnl > 0 ? 'var(--color-success)' : signal.pnl < 0 ? 'var(--color-error)' : 'var(--color-gray-mid)';
                    const row = document.createElement('tr');
                    row.style.borderBottom = '1px solid var(--color-border)';
                    row.innerHTML = `
                        <td style="padding: 8px; text-transform: uppercase; font-family: var(--font-mono); font-size: 0.75rem;">${signal.model}</td>
                        <td style="padding: 8px; max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${signal.market}</td>
                        <td style="padding: 8px; text-transform: uppercase; font-size: 0.75rem;">${signal.direction}</td>
                        <td style="padding: 8px; font-family: var(--font-mono);">${(signal.entry_price * 100).toFixed(1)}¢</td>
                        <td style="padding: 8px; font-family: var(--font-mono); color: ${pnlColor};">$${signal.pnl.toFixed(2)}</td>
                        <td style="padding: 8px; font-size: 0.75rem; text-transform: uppercase;">${signal.status}</td>
                    `;
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                document.getElementById('recent-trades').innerHTML = `<p style="color: var(--color-error);">Failed to load trades: ${error.message}</p>`;
            }
        }

        // Initial load
        updateStatus();
        loadModels();
        loadTrades();
        
        // Refresh every 30 seconds
        setInterval(() => {
            updateStatus();
            loadModels();
            loadTrades();
        }, 30000);
    </script>
</body>
</html>
