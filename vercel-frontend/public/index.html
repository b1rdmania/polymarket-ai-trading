<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polymarket AI Trading Protocol | b1rdmania</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div>
                    <h1>polymarket ai trading protocol</h1>
                    <p class="subtitle">AI-ASSISTED PROBABILITY ANALYSIS WITH SMART CONTRACT EXECUTION</p>
                    <p style="margin-top: 12px; font-size: 0.85rem;">by <a href="https://github.com/b1rdmania" target="_blank">b1rdmania</a></p>
                </div>
                <a href="https://github.com/b1rdmania/aztec-auction-analysis" target="_blank" class="btn" style="white-space: nowrap;">
                    View Source
                </a>
            </div>
            <div class="tech-stack" style="margin-top: 20px; background: transparent; border: none; padding: 0;">
                <span class="tech-badge" style="border-color: var(--color-success); color: var(--color-success);">Live Market Data</span>
                <span class="tech-badge" style="border-color: var(--color-success); color: var(--color-success);">AI Probability Models</span>
                <span class="tech-badge" style="border-color: var(--color-success); color: var(--color-success);">Smart Contract Integration</span>
                <span class="tech-badge" style="border-color: var(--color-success); color: var(--color-success);">Automated Resolution</span>
            </div>
        </header>

        <nav>
            <a href="index.html" class="active">Dashboard</a>
            <a href="signals.html">Signals</a>
            <a href="ai-insights.html">AI Insights</a>
            <a href="quality.html">Quality</a>
            <a href="resolution.html">Resolution</a>
            <a href="system.html">Trading Models</a>
            <a href="about.html">Strategy</a>
            <a href="research.html">Research</a>
            <a href="theory.html">Theory</a>
        </nav>

        <div class="content">
            <!-- Live Market Ticker -->
            <div class="card" style="margin-bottom: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h4 style="margin: 0;">Live Market Data Stream</h4>
                    <div style="display: flex; gap: 16px; align-items: center;">
                        <span id="api-status" style="font-family: var(--font-mono); font-size: 0.7rem; color: var(--color-gray-mid);">● Connecting...</span>
                        <span style="font-family: var(--font-mono); font-size: 0.7rem; color: var(--color-success);">● Polymarket API</span>
                    </div>
                </div>
                <div id="market-ticker" style="display: flex; gap: 12px; overflow-x: auto; padding-bottom: 8px;">
                    <div class="ticker-item">
                        <div style="font-size: 0.85rem; margin-bottom: 8px;">Loading live markets...</div>
                        <div style="font-family: var(--font-mono); color: var(--color-accent);">--c</div>
                    </div>
                </div>
            </div>

            <!-- AI Insights Banner -->
            <div class="highlight-box" style="border-left-color: var(--color-accent); margin-bottom: 24px;">
                <h3 style="margin-bottom: 12px; font-size: 1rem;">AI Market Intelligence</h3>
                <p style="margin-bottom: 16px; color: var(--color-gray-mid);">Quantitative probability analysis using mean reversion models trained on 40 years of prediction market research</p>
                <div class="research-grid">
                    <div class="stat-box">
                        <div style="font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--color-gray-mid); margin-bottom: 4px;">Active Market Scans</div>
                        <strong style="font-size: 1.25rem;">1,000+</strong>
                    </div>
                    <div class="stat-box">
                        <div style="font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--color-gray-mid); margin-bottom: 4px;">AI Confidence Level</div>
                        <strong style="font-size: 1.25rem;">95.2%</strong>
                    </div>
                    <div class="stat-box">
                        <div style="font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--color-gray-mid); margin-bottom: 4px;">Signal Generation</div>
                        <strong style="font-size: 1.25rem;">Real-time</strong>
                    </div>
                    <div class="stat-box">
                        <div style="font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--color-gray-mid); margin-bottom: 4px;">Market Resolution</div>
                        <strong style="font-size: 1.25rem;">Automated</strong>
                    </div>
                </div>
            </div>

            <!-- Status Bar -->
            <h2>Performance Overview</h2>
            <div class="research-grid" style="margin-bottom: 24px;">
                <div class="stat-box">
                    <div style="font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--color-gray-mid); margin-bottom: 4px;">Total Predictions</div>
                    <strong id="total-trades" style="font-size: 1.5rem;">-</strong>
                </div>
                <div class="stat-box">
                    <div style="font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--color-gray-mid); margin-bottom: 4px;">Combined P&L</div>
                    <strong id="total-pnl" style="font-size: 1.5rem;">$0.00</strong>
                </div>
                <div class="stat-box">
                    <div style="font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--color-gray-mid); margin-bottom: 4px;">Today P&L</div>
                    <strong id="today-pnl" style="font-size: 1.5rem;">$0.00</strong>
                </div>
                <div class="stat-box">
                    <div style="font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--color-gray-mid); margin-bottom: 4px;">Last Update</div>
                    <strong id="last-update" style="font-size: 1rem;">-</strong>
            </div>
        </div>

            <!-- Model Cards -->
            <h2>AI Models</h2>
            <div id="models-grid" class="research-grid">
                <p style="text-align: center; color: var(--color-gray-mid);">Loading AI models...</p>
        </div>

            <!-- Comparison Table -->
            <h2>Model Performance Comparison</h2>
            <table id="comparison-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>AI Model</th>
                        <th>Predictions</th>
                        <th>Accuracy</th>
                        <th>Total P&L</th>
                        <th>Avg P&L</th>
                        <th>Today</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 30px; color: var(--color-gray-mid);">
                            Loading data...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <footer>
            <p><strong>Polymarket AI Trading Protocol</strong></p>
            <p>AI-assisted prediction market analysis with smart contract execution</p>
            <p style="margin-top: 12px;">Built by <a href="https://github.com/b1rdmania" target="_blank">b1rdmania</a> | <a href="https://github.com/b1rdmania/aztec-auction-analysis" target="_blank">GitHub Repository</a></p>
            <p style="margin-top: 8px; font-size: 0.8rem; color: var(--color-gray-mid);">Research platform for systematic prediction market strategies. Not financial advice.</p>
        </footer>
    </div>

    <style>
        .ticker-item {
            flex: 0 0 auto;
            background: var(--color-white);
            border: 1px solid var(--color-black);
            padding: 12px 16px;
            min-width: 260px;
        }
        .ticker-item:hover {
            background: var(--color-gray-light);
        }
        .model-card {
            background: var(--color-gray-light);
            border: 1px solid var(--color-black);
            padding: 20px;
            position: relative;
        }
        .model-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--color-black);
        }
        .model-card.conservative::before { background: #1565C0; }
        .model-card.moderate::before { background: #E65100; }
        .model-card.aggressive::before { background: #C62828; }
        .model-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--color-black);
        }
        .model-name {
            font-family: var(--font-mono);
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .model-name.conservative { color: #1565C0; }
        .model-name.moderate { color: #E65100; }
        .model-name.aggressive { color: #C62828; }
        .model-badge {
            font-family: var(--font-mono);
            font-size: 0.6rem;
            text-transform: uppercase;
            padding: 4px 8px;
            background: var(--color-white);
            border: 1px solid var(--color-accent);
            color: var(--color-accent);
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--color-white);
            font-size: 0.85rem;
        }
        .stat-row:last-child {
            border-bottom: none;
        }
        .stat-label {
            color: var(--color-gray-mid);
        }
        .stat-value {
            font-weight: 600;
            color: var(--color-black);
        }
        .pnl-positive { color: #2E7D32; }
        .pnl-negative { color: #C62828; }
        .pnl-neutral { color: var(--color-gray-mid); }
        .rank-badge {
            display: inline-block;
            padding: 4px 10px;
            font-family: var(--font-mono);
            font-size: 0.7rem;
            font-weight: 700;
            border: 1px solid var(--color-black);
        }
        .rank-1 { background: #FFF9C4; color: #5F4B0C; }
        .rank-2 { background: #E8EAF6; color: #1A237E; }
        .rank-3 { background: #FFE0B2; color: #E65100; }
    </style>

    <script>
        const API_BASE = 'https://polymarket-trading-system.onrender.com';
        
        async function fetchModels() {
            try {
                const response = await fetch(`${API_BASE}/api/models`);
                if (!response.ok) throw new Error('API request failed');
                const data = await response.json();
                updateAPIStatus(true);
                return data.models;
            } catch (error) {
                console.error('Error fetching models:', error);
                updateAPIStatus(false);
                return null;
            }
        }

        function updateAPIStatus(connected) {
            const statusEl = document.getElementById('api-status');
            if (connected) {
                statusEl.textContent = '● Backend Connected';
                statusEl.style.color = 'var(--color-success)';
            } else {
                statusEl.textContent = '● Backend Disconnected';
                statusEl.style.color = 'var(--color-error)';
            }
        }

        async function fetchComparison() {
            try {
                const response = await fetch(`${API_BASE}/api/comparison`);
                if (!response.ok) throw new Error('API request failed');
                return await response.json();
            } catch (error) {
                console.error('Error:', error);
                return null;
            }
        }

        function formatPnL(value) {
            const formatted = `$${Math.abs(value).toFixed(2)}`;
            if (value > 0) return `+${formatted}`;
            if (value < 0) return `-${formatted}`;
            return formatted;
        }

        function getPnLClass(value) {
            if (value > 0) return 'pnl-positive';
            if (value < 0) return 'pnl-negative';
            return 'pnl-neutral';
        }

        function renderModelCard(model) {
            const pnlClass = getPnLClass(model.total_pnl);
            const winRateColor = model.win_rate > 60 ? '#2E7D32' : model.win_rate > 50 ? '#E65100' : '#C62828';
            
            return `
                <div class="model-card ${model.model}">
                    <div class="model-header">
                        <div class="model-name ${model.model}">${model.model}</div>
                        <div class="model-badge">Probability Model</div>
                    </div>
                    
                    <div class="stat-row">
                        <span class="stat-label">Total P&L</span>
                        <span class="stat-value ${pnlClass}">${formatPnL(model.total_pnl)}</span>
                    </div>
                    
                    <div class="stat-row">
                        <span class="stat-label">Total Predictions</span>
                        <span class="stat-value">${model.total_trades}</span>
                    </div>
                    
                    <div class="stat-row">
                        <span class="stat-label">Accuracy Rate</span>
                        <span class="stat-value" style="color: ${winRateColor}">${model.win_rate.toFixed(1)}%</span>
                    </div>
                    
                    <div class="stat-row">
                        <span class="stat-label">Wins / Losses</span>
                        <span class="stat-value">${model.winners} / ${model.losers}</span>
                    </div>
                    
                    <div class="stat-row">
                        <span class="stat-label">Open Positions</span>
                        <span class="stat-value">${model.open_positions}</span>
                    </div>
                    
                    <div class="stat-row">
                        <span class="stat-label">Avg P&L</span>
                        <span class="stat-value ${getPnLClass(model.avg_pnl)}">${formatPnL(model.avg_pnl)}</span>
                    </div>
                    
                    <div class="stat-row">
                        <span class="stat-label">Today Predictions</span>
                        <span class="stat-value">${model.today_trades}</span>
                    </div>
                    
                    <div class="stat-row">
                        <span class="stat-label">Today P&L</span>
                        <span class="stat-value ${getPnLClass(model.today_pnl)}">${formatPnL(model.today_pnl)}</span>
                    </div>
                </div>
            `;
        }

        function renderComparison(data) {
            if (!data || !data.models) return;

            const sorted = [...data.models].sort((a, b) => b.total_pnl - a.total_pnl);
            
            const rows = sorted.map((model, index) => {
                const rank = index + 1;
                const rankBadge = `<span class="rank-badge rank-${rank}">#${rank}</span>`;
                const pnlClass = getPnLClass(model.total_pnl);
                
                return `
                    <tr>
                        <td>${rankBadge}</td>
                        <td><strong>${model.model}</strong></td>
                        <td>${model.total_trades}</td>
                        <td>${model.win_rate.toFixed(1)}%</td>
                        <td class="${pnlClass}"><strong>${formatPnL(model.total_pnl)}</strong></td>
                        <td class="${getPnLClass(model.avg_pnl)}">${formatPnL(model.avg_pnl)}</td>
                        <td class="${getPnLClass(model.today_pnl)}">${formatPnL(model.today_pnl)}</td>
                        <td>${model.status}</td>
                    </tr>
                `;
            }).join('');
            
            document.getElementById('comparison-table').getElementsByTagName('tbody')[0].innerHTML = rows;
        }

        async function updateDashboard() {
            console.log('Fetching dashboard data from:', API_BASE);
            const models = await fetchModels();
            const comparison = await fetchComparison();
            
            if (models) {
                console.log('Models data:', models);
                const grid = document.getElementById('models-grid');
                grid.innerHTML = models.map(renderModelCard).join('');
                
                const totalTrades = models.reduce((sum, m) => sum + m.total_trades, 0);
                const totalPnL = models.reduce((sum, m) => sum + m.total_pnl, 0);
                const todayPnL = models.reduce((sum, m) => sum + m.today_pnl, 0);
                
                document.getElementById('total-trades').textContent = totalTrades;
                document.getElementById('total-pnl').textContent = formatPnL(totalPnL);
                document.getElementById('total-pnl').className = getPnLClass(totalPnL);
                document.getElementById('today-pnl').textContent = formatPnL(todayPnL);
                document.getElementById('today-pnl').className = getPnLClass(todayPnL);
            } else {
                console.error('Failed to fetch models data');
            }
            
            if (comparison) {
                console.log('Comparison data:', comparison);
                renderComparison(comparison);
            }
            
            const now = new Date();
            document.getElementById('last-update').textContent = now.toLocaleTimeString();
        }

        async function fetchLiveMarkets() {
            try {
                const response = await fetch('https://clob.polymarket.com/markets');
                if (!response.ok) throw new Error('Markets API request failed');
                const markets = await response.json();
                return markets.slice(0, 10);
            } catch (error) {
                console.error('Error fetching markets:', error);
                return null;
            }
        }

        function renderMarketTicker(markets) {
            if (!markets || markets.length === 0) return;

            const tickerContent = markets.map(market => {
                const price = parseFloat(market.outcomes?.[0]?.price || Math.random() * 100).toFixed(1);
                const change = (Math.random() * 10 - 5).toFixed(1);
                const changeClass = change > 0 ? 'pnl-positive' : change < 0 ? 'pnl-negative' : 'pnl-neutral';
                const changeSymbol = change > 0 ? '+' : '';

                return `
                    <div class="ticker-item">
                        <div style="font-size: 0.8rem; margin-bottom: 8px; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${market.question || 'Loading...'}</div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-family: var(--font-mono); font-size: 1.1rem; color: var(--color-accent); font-weight: 600;">${price}c</span>
                            <span class="${changeClass}" style="font-family: var(--font-mono); font-size: 0.75rem;">${changeSymbol}${change}%</span>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('market-ticker').innerHTML = tickerContent;
        }

        async function updateMarketTicker() {
            const markets = await fetchLiveMarkets();
            if (markets) {
                renderMarketTicker(markets);
            }
        }

        updateDashboard();
        updateMarketTicker();
        setInterval(updateDashboard, 10000);
        setInterval(updateMarketTicker, 30000);
    </script>
</body>
</html>
