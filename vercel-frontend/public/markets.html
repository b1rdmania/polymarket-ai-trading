<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Scanner | Polymarket AI Trading</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .log-container {
            font-family: var(--font-mono);
            font-size: 0.8rem;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 16px;
            border-radius: 4px;
            max-height: 500px;
            overflow-y: auto;
            line-height: 1.6;
        }
        .log-time { color: #666; }
        .log-info { color: #60a5fa; }
        .log-success { color: #4ade80; }
        .log-warning { color: #fbbf24; }
        .log-error { color: #f87171; }
        .log-dim { color: #888; }
        .log-highlight { color: #fff; font-weight: 600; }
        .log-entry { margin-bottom: 2px; }
        .log-indent { padding-left: 20px; }
        .scan-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        .stat-box {
            background: var(--color-gray-light);
            padding: 12px;
            border-radius: 4px;
            text-align: center;
        }
        .stat-value {
            font-family: var(--font-mono);
            font-size: 1.5rem;
            font-weight: 600;
        }
        .stat-label {
            font-size: 0.7rem;
            color: var(--color-gray-mid);
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1>polymarket ai trading</h1>
                    <p class="subtitle">MARKET SCANNER</p>
                </div>
                <a href="https://github.com/b1rdmania/polymarket-ai-trading" target="_blank" class="btn">View Code</a>
            </div>
        </header>

        <nav>
            <a href="index.html">Dashboard</a>
            <a href="markets.html" class="active">Scanner</a>
            <a href="research.html">Research</a>
        </nav>

        <div class="content">
            <div class="card">
                <h3>Live Market Analysis</h3>
                <p style="margin-top: 8px; color: var(--color-gray-mid); font-size: 0.9rem;">
                    Watch our models scan and evaluate Polymarket in real-time. 
                    See <a href="research.html">Research</a> for methodology.
                </p>
                
                <div class="scan-stats" style="margin-top: 20px;">
                    <div class="stat-box">
                        <div class="stat-value" id="stat-scanned">--</div>
                        <div class="stat-label">MARKETS SCANNED</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stat-qualified">--</div>
                        <div class="stat-label">QUALIFIED</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stat-signals">--</div>
                        <div class="stat-label">SIGNALS</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stat-extreme">--</div>
                        <div class="stat-label">EXTREME</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h3>Scan Log</h3>
                    <button onclick="runScan()" class="btn" style="padding: 6px 12px; font-size: 0.75rem;">Run Scan</button>
                </div>
                <div class="log-container" id="log-container">
                    <div class="log-entry log-dim">Initializing scanner...</div>
                </div>
            </div>

            <div style="margin-top: 24px; color: var(--color-gray-mid); font-size: 0.8rem;">
                <p><strong>How it works:</strong> We fetch live markets from Polymarket, filter by volume and liquidity, 
                then score each for mean reversion potential. Extreme prices (>85% or <15%) often signal overreaction.</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://polymarket-trading-system.onrender.com';
        const logContainer = document.getElementById('log-container');
        
        // Scoring thresholds (from research)
        const MIN_VOLUME = 100000;      // $100k minimum
        const HIGH_VOLUME = 500000;     // $500k = high quality
        const EXTREME_LOW = 15;         // Below 15% = extreme
        const EXTREME_HIGH = 85;        // Above 85% = extreme
        const WATCH_LOW = 30;           // Below 30% = watching
        const WATCH_HIGH = 70;          // Above 70% = watching
        
        function getTime() {
            return new Date().toLocaleTimeString('en-US', { hour12: false });
        }
        
        function log(message, type = '') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.innerHTML = `<span class="log-time">[${getTime()}]</span> ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function logIndent(message, type = '') {
            const entry = document.createElement('div');
            entry.className = `log-entry log-indent ${type}`;
            entry.innerHTML = message;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        async function runScan() {
            logContainer.innerHTML = '';
            
            log('Starting market scan...', 'log-info');
            await sleep(300);
            
            log('Connecting to Polymarket API via proxy...', 'log-dim');
            await sleep(200);
            
            try {
                const response = await fetch(`${API_BASE}/api/markets/live`);
                if (!response.ok) throw new Error(`API error: ${response.status}`);
                
                const data = await response.json();
                const allMarkets = data.markets || [];
                
                log(`Received <span class="log-highlight">${allMarkets.length}</span> markets from API`, 'log-success');
                document.getElementById('stat-scanned').textContent = allMarkets.length;
                await sleep(400);
                
                // Filter by volume
                log('Filtering by volume (min $100k)...', 'log-dim');
                await sleep(200);
                
                const qualified = allMarkets.filter(m => parseFloat(m.volume || 0) >= MIN_VOLUME);
                log(`<span class="log-highlight">${qualified.length}</span> markets meet volume threshold`, 'log-info');
                document.getElementById('stat-qualified').textContent = qualified.length;
                await sleep(300);
                
                // Analyze each market
                log('Beginning mean reversion analysis...', 'log-info');
                log('─'.repeat(50), 'log-dim');
                await sleep(300);
                
                let signalCount = 0;
                let extremeCount = 0;
                
                // Analyze top markets by volume
                const topMarkets = qualified.slice(0, 15);
                
                for (const market of topMarkets) {
                    const vol = parseFloat(market.volume || 0);
                    const volStr = vol >= 1000000 ? `$${(vol/1000000).toFixed(1)}M` : `$${(vol/1000).toFixed(0)}k`;
                    
                    // Get prices
                    let yesPrice = null;
                    const prices = market.outcomePrices;
                    if (prices && Array.isArray(prices) && prices.length >= 1) {
                        yesPrice = parseFloat(prices[0]) * 100;
                    }
                    
                    const question = market.question?.substring(0, 50) + (market.question?.length > 50 ? '...' : '');
                    
                    log(`Evaluating: "${question}"`, '');
                    await sleep(150);
                    
                    if (yesPrice === null) {
                        logIndent(`<span class="log-error">✗ No price data available</span>`, '');
                        await sleep(100);
                        continue;
                    }
                    
                    const priceStr = `YES: ${yesPrice.toFixed(0)}¢`;
                    logIndent(`<span class="log-dim">${priceStr} | Volume: ${volStr}</span>`, '');
                    await sleep(100);
                    
                    // Determine signal
                    let signal = '';
                    let action = '';
                    
                    if (yesPrice <= EXTREME_LOW) {
                        signal = '<span class="log-warning">EXTREME LOW</span>';
                        action = '<span class="log-success">→ SIGNAL: Potential undervaluation</span>';
                        signalCount++;
                        extremeCount++;
                    } else if (yesPrice >= EXTREME_HIGH) {
                        signal = '<span class="log-warning">EXTREME HIGH</span>';
                        action = '<span class="log-success">→ SIGNAL: Potential overvaluation</span>';
                        signalCount++;
                        extremeCount++;
                    } else if (yesPrice <= WATCH_LOW || yesPrice >= WATCH_HIGH) {
                        signal = '<span class="log-info">WATCHING</span>';
                        action = '<span class="log-dim">→ Monitoring for movement</span>';
                        signalCount++;
                    } else {
                        signal = '<span class="log-dim">NEUTRAL</span>';
                        action = '<span class="log-dim">→ No signal (price in normal range)</span>';
                    }
                    
                    logIndent(`Signal: ${signal}`, '');
                    logIndent(action, '');
                    await sleep(200);
                }
                
                document.getElementById('stat-signals').textContent = signalCount;
                document.getElementById('stat-extreme').textContent = extremeCount;
                
                log('─'.repeat(50), 'log-dim');
                await sleep(200);
                log(`Scan complete. <span class="log-highlight">${signalCount}</span> signals detected, <span class="log-warning">${extremeCount}</span> extreme.`, 'log-success');
                
                if (extremeCount > 0) {
                    log('⚡ Extreme prices detected - potential mean reversion opportunities', 'log-warning');
                }
                
                log('<span class="log-dim">Next scan in 60 seconds...</span>', '');
                
            } catch (error) {
                log(`<span class="log-error">Error: ${error.message}</span>`, '');
            }
        }
        
        // Run initial scan
        runScan();
        
        // Auto-refresh every 60s
        setInterval(runScan, 60000);
    </script>
</body>
</html>
